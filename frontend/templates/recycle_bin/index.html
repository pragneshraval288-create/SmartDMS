{% extends "base.html" %}
{% block title %}Recycle Bin - SmartDMS{% endblock %}

{% block content %}

<!-- ================= HEADER ================= -->
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">
        <i class="bi bi-trash"></i> Recycle Bin
    </h1>

    <!-- ðŸ”¥ EMPTY BIN -->
    <form method="POST" action="{{ url_for('recycle_bin.empty_recycle_bin') }}"
        onsubmit="return confirm('This will permanently delete all items. Continue?')">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button class="btn btn-sm btn-danger">
            Empty Recycle Bin
        </button>
    </form>
</div>

<div class="alert alert-warning small">
    Items in Recycle Bin will be permanently deleted after <strong>30 days</strong>.
</div>

<!-- =========================
     DELETED FOLDERS
========================= -->
<div class="card mb-4">
    <div class="card-header fw-semibold">
        Deleted Folders
    </div>

    <div class="card-body p-0">
        {% if deleted_folders %}
        <table class="table table-hover table-sm mb-0">
            <thead class="table-light">
                <tr>
                    <th>Name</th>
                    <th>Deleted At</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for folder in deleted_folders %}
                <tr>
                    <td>
                        <i class="bi bi-folder-fill text-warning me-1"></i>
                        {{ folder.name }}
                    </td>
                    <td>{{ folder.deleted_at|ist }}</td>
                    <td class="text-end">
                        <div class="dropdown">
                            <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
                                &#x22EE;
                            </button>

                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <form method="POST"
                                        action="{{ url_for('recycle_bin.restore_folder', folder_id=folder.id) }}">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button class="dropdown-item">
                                            Restore
                                        </button>
                                    </form>
                                </li>

                                <li>
                                    <form method="POST"
                                        action="{{ url_for('recycle_bin.delete_folder_permanently', folder_id=folder.id) }}"
                                        onsubmit="return confirm('Permanently delete this folder?')">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button class="dropdown-item text-danger">
                                            Delete Permanently
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="p-3 text-muted small">
            No folders in recycle bin.
        </div>
        {% endif %}
    </div>
</div>

<!-- =========================
     DELETED DOCUMENTS
========================= -->
<div class="card">
    <div class="card-header fw-semibold">
        Deleted Documents
    </div>

    <div class="card-body p-0">
        {% if deleted_documents %}
        <table class="table table-hover table-sm mb-0">
            <thead class="table-light">
                <tr>
                    <th>Title</th>
                    <th>Type</th>
                    <th>Deleted At</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in deleted_documents %}
                <tr>
                    <td>{{ doc.title }}</td>
                    <td class="text-uppercase small">{{ doc.file_type }}</td>
                    <td>{{ doc.deleted_at|ist }}</td>
                    <td class="text-end">
                        <div class="dropdown">
                            <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
                                &#x22EE;
                            </button>

                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <form method="POST"
                                        action="{{ url_for('recycle_bin.restore_document', document_id=doc.id) }}">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button class="dropdown-item">
                                            Restore
                                        </button>
                                    </form>
                                </li>

                                <li>
                                    <form method="POST"
                                        action="{{ url_for('recycle_bin.delete_document_permanently', document_id=doc.id) }}"
                                        onsubmit="return confirm('Permanently delete this document?')">
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        <button class="dropdown-item text-danger">
                                            Delete Permanently
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="p-3 text-muted small">
            No documents in recycle bin.
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}